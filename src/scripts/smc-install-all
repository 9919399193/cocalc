#!/usr/bin/env bash

set -e
set -v

cd `dirname $0`/..
. smc-env

# npm audit fix is disabled, because sometimes it errors saying that
# the "endpoint is not available"
run_install() {
    cd "$1"
    npm ci
    #npm audit fix
}

. cocalc-dirs.sh

for dir in "${CODE_DIRS[@]}"; do
    run_install "$dir"
done

# assistant example code snippets
cd $SMC_ROOT
git submodule update --init
cd $SMC_ROOT/examples
env OUTDIR=../webapp-lib/examples make

# generating color scheme
cd $SMC_ROOT
scripts/update_color_scheme.coffee

# static react pages update must come *before* webpack
cd $SMC_ROOT
update_react_static
